# 实施计划: Mira 桌面摄像精灵

## 概述

本实施计划将 Mira 的设计分解为离散的编码步骤，每个任务都建立在前面的任务之上。计划包括核心功能实现、基于属性的测试和集成测试。项目使用 Rust 开发，支持 Windows 和 macOS 平台。

## 任务

- [x] 1. 项目初始化和基础架构
  - 创建 Rust 项目结构（使用 `cargo new --bin mira`）
  - 添加核心依赖到 `Cargo.toml`：nokhwa、winit、wgpu、image、serde、toml、log、env_logger
  - 添加测试依赖：quickcheck、mockall、criterion
  - 设置项目目录结构（src/camera、src/window、src/render、src/shape、src/config）
  - 创建基础错误类型定义（MiraError 枚举）
  - _需求: 9.1, 9.2, 11.4, 11.5_

- [x] 2. 完善摄像头管理器实现
  - [x] 2.1 实现 CameraManager 核心功能
    - 使用 nokhwa 库实现设备枚举（`query()` 函数）
    - 实现 `enumerate_devices()` 方法，返回 CameraInfo 列表
    - 实现 `open_device()` 方法，使用 nokhwa::Camera::new()
    - 实现 `close_device()` 方法，停止视频流并释放设备
    - 实现 `capture_frame()` 方法，捕获并转换帧格式
    - 添加设备状态管理（当前设备索引、是否正在捕获）
    - _需求: 1.1, 1.2, 1.3, 1.5, 1.6_
  
  - [x] 2.2 实现摄像头错误处理
    - 处理 nokhwa 错误并转换为 CameraError 类型
    - 实现设备权限检查和友好错误消息
    - 添加设备占用检测逻辑
    - 实现捕获失败重试机制（最多 3 次）
    - _需求: 1.4, 8.1, 8.2, 8.3, 8.4_
  
  - [ ]* 2.3 编写摄像头管理器的基于属性的测试
    - **属性 1: 设备枚举完整性** - 验证枚举返回所有可用设备
    - **属性 2: 设备激活后可捕获** - 验证激活设备后能捕获帧
    - **属性 3: 设备错误处理** - 验证错误情况返回正确错误类型
    - **属性 4: 设备切换一致性** - 验证设备切换的状态一致性
    - **属性 5: 设备资源释放** - 验证设备关闭后资源被释放
    - **验证需求: 1.1-1.5, 7.2**
  
  - [ ]* 2.4 编写摄像头管理器的单元测试
    - 测试无设备情况的处理
    - 测试设备权限拒绝的处理
    - 测试设备被占用的处理
    - 测试帧格式转换逻辑
    - _需求: 8.1, 8.2, 8.3_

- [x] 3. 完善形状遮罩系统实现
  - [x] 3.1 实现形状生成算法
    - 实现圆形遮罩生成算法（`generate_circle()`）
    - 实现椭圆形遮罩生成算法（`generate_ellipse()`）
    - 实现矩形遮罩生成算法（`generate_rectangle()`）
    - 实现圆角矩形遮罩生成算法（`generate_rounded_rectangle()`）
    - 实现心形遮罩生成算法（`generate_heart()`，使用参数方程）
    - 优化遮罩生成性能，确保切换时间 < 100ms
    - _需求: 3.1, 3.2, 3.4, 3.5_
  
  - [ ]* 3.2 编写形状遮罩的基于属性的测试
    - **属性 9: 形状遮罩应用** - 验证形状切换的正确性
    - **属性 10: 遮罩外部透明性** - 验证形状外部像素为透明
    - **属性 11: 遮罩尺寸自适应** - 验证遮罩随窗口尺寸调整
    - **验证需求: 3.2, 3.5, 3.6**
  
  - [ ]* 3.3 编写形状遮罩的单元测试
    - 测试预设形状数量（至少 5 种）
    - 测试每种形状的边界检测
    - 测试遮罩数据格式（alpha 通道）
    - _需求: 3.1, 3.5_

- [x] 4. 实现窗口管理器
  - [x] 4.1 创建基础窗口功能
    - 使用 winit 创建窗口，设置 `WindowLevel::AlwaysOnTop`
    - 启用窗口透明背景（`with_transparent(true)`）
    - 实现窗口位置和尺寸管理
    - 实现窗口边界约束逻辑（至少 20% 在屏幕内）
    - 添加窗口状态跟踪（位置、尺寸、旋转角度）
    - _需求: 2.1, 2.2, 2.6, 4.5_
  
  - [x] 4.2 实现窗口拖拽功能
    - 实现 `start_drag()`、`update_drag()`、`end_drag()` 方法
    - 处理鼠标按下、移动、释放事件
    - 计算拖拽偏移量并实时更新窗口位置
    - 确保拖拽响应时间 < 16ms
    - _需求: 4.1, 4.2, 4.3, 4.6_
  
  - [x] 4.3 实现窗口缩放功能
    - 实现 `scale()` 方法，支持百分比缩放
    - 处理鼠标滚轮事件（向上 +10%，向下 -10%）
    - 限制最小尺寸（100x100）和最大尺寸（屏幕的 80%）
    - 保持宽高比不变
    - _需求: 5.1, 5.2, 5.3, 5.4, 5.5, 5.6_
  
  - [x] 4.4 实现窗口旋转功能
    - 添加旋转角度存储和管理
    - 处理 Ctrl + 鼠标滚轮事件（每次 ±15 度）
    - 实现角度归一化（0-360 度范围）
    - 实现自动对齐逻辑（0°、90°、180°、270° ±5° 范围内自动对齐）
    - _需求: 6.1, 6.2, 6.3, 6.4, 6.6_
  
  - [ ]* 4.5 编写窗口管理器的基于属性的测试
    - **属性 6: 窗口置顶不变性** - 验证窗口始终置顶
    - **属性 7: 窗口透明度支持** - 验证窗口支持透明背景
    - **属性 8: 窗口可见性** - 验证激活设备后存在对应可见窗口
    - **属性 12: 拖拽状态转换** - 验证拖拽状态的正确转换
    - **属性 13: 拖拽位置跟随** - 验证拖拽时位置跟随鼠标
    - **属性 14: 窗口边界约束** - 验证窗口边界约束逻辑
    - **属性 15: 窗口缩放比例** - 验证缩放比例和宽高比
    - **属性 16: 窗口旋转增量** - 验证旋转角度增量
    - **属性 17: 旋转角度对齐** - 验证自动对齐功能
    - **验证需求: 2.1, 2.2, 2.6, 4.1-4.6, 5.1-5.6, 6.1-6.6**
  
  - [ ]* 4.6 编写窗口管理器的单元测试
    - 测试窗口创建和初始化
    - 测试边界情况（最小/最大尺寸）
    - 测试旋转角度边界情况
    - _需求: 2.1, 5.4, 5.5, 6.4_

- [x] 5. 检查点 - 确保核心组件测试通过
  - 运行所有已实现的单元测试和属性测试
  - 确保摄像头、形状遮罩、窗口管理器功能正常
  - 如有问题请询问用户

- [x] 6. 实现 GPU 渲染引擎
  - [x] 6.1 创建渲染引擎基础结构
    - 使用 wgpu 初始化 GPU 设备、队列和表面
    - 配置表面格式（优先使用 Bgra8UnormSrgb）
    - 创建渲染管线描述符
    - 实现渲染引擎错误处理
    - _需求: 2.1, 2.4_
  
  - [x] 6.2 实现纹理管理
    - 实现 `upload_frame()` 方法，上传视频帧到 GPU
    - 实现 `set_mask()` 方法，上传形状遮罩到 GPU
    - 创建和管理视频纹理（RGB/RGBA 格式）
    - 创建和管理遮罩纹理（单通道 alpha）
    - 处理不同像素格式的转换
    - _需求: 2.1, 2.4, 3.2_
  
  - [x] 6.3 编写 WGSL 着色器
    - 编写顶点着色器：实现旋转变换矩阵
    - 编写片段着色器：采样视频纹理和遮罩纹理
    - 实现遮罩应用逻辑（video.rgb * mask.a）
    - 支持透明度输出
    - _需求: 3.2, 3.5, 6.1_
  
  - [x] 6.4 实现渲染循环
    - 实现 `render()` 方法
    - 获取表面纹理并创建渲染通道
    - 绑定纹理和采样器
    - 执行绘制命令并提交队列
    - 确保渲染帧率 ≥ 30 FPS
    - _需求: 2.1, 2.4, 2.5_
  
  - [x]* 6.5 编写渲染引擎的单元测试
    - 测试 GPU 初始化流程
    - 测试纹理创建和上传
    - 测试渲染管线配置
    - 测试着色器编译
    - _需求: 2.1, 2.4_

- [x] 7. 实现配置管理器
  - [x] 7.1 完善配置文件处理
    - 确定配置文件路径（Windows: %APPDATA%\Mira\config.toml，macOS: ~/Library/Application Support/Mira/config.toml）
    - 实现 `load()` 方法，从 TOML 文件读取配置
    - 实现 `save()` 方法，写入配置到 TOML 文件
    - 处理配置文件不存在的情况（创建默认配置）
    - 处理配置文件损坏的情况（备份并使用默认配置）
    - _需求: 7.3, 7.4, 7.6_
  
  - [x] 7.2 实现配置验证和迁移
    - 添加配置版本管理
    - 实现配置字段验证（尺寸、位置、角度范围）
    - 处理无效配置值（自动修正到有效范围）
    - 实现配置目录创建逻辑
    - _需求: 7.3, 7.4_
  
  - [ ]* 7.3 编写配置管理器的基于属性的测试
    - **属性 18: 配置往返一致性** - 验证保存后加载的配置一致性
    - **验证需求: 7.3, 7.4, 7.6**
  
  - [ ]* 7.4 编写配置管理器的单元测试
    - 测试默认配置生成
    - 测试配置文件不存在的处理
    - 测试配置文件损坏的处理
    - 测试配置验证逻辑
    - _需求: 7.3, 7.4, 8.1_

- [x] 8. 实现事件处理器
  - [x] 8.1 创建事件处理器结构
    - 定义 EventHandler 结构体，包含所有管理器的引用
    - 实现 `new()` 方法，初始化事件处理器
    - 实现 `handle_window_event()` 方法，分发窗口事件
    - 添加事件状态管理（拖拽状态、按键状态）
    - _需求: 4.1, 4.2, 4.3, 5.1, 6.1_
  
  - [x] 8.2 实现鼠标事件处理
    - 实现 `handle_mouse_press()` 方法（开始拖拽）
    - 实现 `handle_mouse_release()` 方法（结束拖拽）
    - 实现 `handle_mouse_move()` 方法（更新拖拽位置）
    - 实现 `handle_mouse_wheel()` 方法（缩放或旋转）
    - 检测 Ctrl 键状态（区分缩放和旋转）
    - _需求: 4.1, 4.2, 4.3, 5.1, 5.2, 5.3, 6.1, 6.2_
  
  - [x] 8.3 实现键盘和窗口事件处理
    - 处理窗口调整大小事件（调整渲染表面和遮罩）
    - 处理窗口关闭事件（保存配置并清理资源）
    - 实现键盘快捷键（形状切换、设备切换等）
    - _需求: 3.6, 7.3_
  
  - [x] 8.4 实现渲染帧方法
    - 实现 `render_frame()` 方法
    - 从摄像头捕获帧并上传到 GPU
    - 调用渲染引擎渲染当前帧
    - 处理捕获和渲染错误（记录日志并尝试恢复）
    - _需求: 2.1, 2.4, 8.4_
  
  - [ ]* 8.5 编写事件处理器的单元测试
    - 测试鼠标事件处理逻辑
    - 测试键盘事件处理逻辑
    - 测试 Ctrl 键检测逻辑
    - 测试事件状态管理
    - _需求: 4.1, 4.2, 4.3, 5.1, 6.1_

- [x] 9. 实现应用程序主循环
  - [x] 9.1 创建应用初始化逻辑
    - 初始化日志系统（env_logger，配置日志文件路径）
    - 创建事件循环（EventLoop）
    - 初始化 ConfigManager 并加载配置
    - 初始化 CameraManager 并枚举设备
    - 打开默认摄像头设备（或配置中的设备）
    - 初始化 WindowManager（使用配置中的位置和尺寸）
    - 初始化 RenderEngine 和 ShapeMask
    - 创建 EventHandler
    - _需求: 1.1, 1.3, 7.1, 7.4_
  
  - [x] 9.2 实现主事件循环
    - 运行 winit 事件循环（`event_loop.run()`）
    - 处理 WindowEvent（调用 EventHandler）
    - 处理 RedrawRequested 事件（调用 render_frame）
    - 处理 CloseRequested 事件（保存配置并退出）
    - 实现帧率控制（目标 30+ FPS）
    - _需求: 2.1, 2.4, 4.1, 7.3_
  
  - [x] 9.3 实现资源清理和错误处理
    - 实现 Drop trait 确保资源释放
    - 添加错误日志记录（使用 log 宏）
    - 处理初始化失败（显示错误消息并退出）
    - 处理运行时错误（记录日志并尝试恢复）
    - 确保应用启动时间 < 3 秒
    - _需求: 7.1, 7.2, 7.5, 8.1, 8.2, 8.3, 8.4, 8.6_
  
  - [ ]* 9.4 编写应用生命周期的单元测试
    - 测试应用初始化流程
    - 测试配置加载和恢复
    - 测试资源清理逻辑
    - 测试错误处理流程
    - _需求: 7.1, 7.2, 7.3, 7.4_

- [x] 10. 检查点 - 确保核心功能集成测试通过
  - 运行完整的应用程序
  - 测试摄像头设备枚举和切换
  - 测试窗口拖拽、缩放、旋转功能
  - 测试形状遮罩切换
  - 测试配置保存和恢复
  - 如有问题请询问用户

- [x] 11. 实现日志系统和高级错误处理
  - [x] 11.1 配置完整的日志系统
    - 设置日志文件路径（Windows: %APPDATA%\Mira\logs\mira.log，macOS: ~/Library/Application Support/Mira/logs/mira.log）
    - 配置日志级别（默认 INFO，可通过环境变量调整）
    - 配置日志格式（时间戳 + 级别 + 模块 + 消息）
    - 实现日志文件轮转（避免日志文件过大）
    - _需求: 8.6_
  
  - [x] 11.2 添加全面的错误日志记录
    - 在所有错误处理点添加详细日志记录
    - 记录摄像头错误（设备枚举、打开、捕获失败）
    - 记录窗口错误（创建失败、无效尺寸/位置）
    - 记录渲染错误（初始化失败、纹理上传失败）
    - 记录配置错误（文件读写失败、解析错误）
    - 记录性能指标（帧率、内存使用）
    - _需求: 8.1, 8.2, 8.3, 8.4, 8.6_
  
  - [ ]* 11.3 编写日志和错误处理的基于属性的测试
    - **属性 19: 错误日志记录** - 验证所有错误都被记录
    - **属性 20: 捕获失败重试** - 验证捕获失败时的重试逻辑
    - **验证需求: 8.4, 8.6**

- [x] 12. 实现性能优化和内存管理
  - [x] 12.1 添加内存管理优化
    - 使用对象池复用帧缓冲区
    - 及时释放不再使用的 GPU 纹理
    - 限制帧缓冲区队列长度（避免内存积累）
    - 实现内存使用监控和报告
    - _需求: 10.1, 10.2, 10.6_
  
  - [x] 12.2 实现性能监控
    - 添加帧率计算和显示
    - 监控 CPU 和内存使用率
    - 实现性能指标日志记录
    - 添加性能警告（帧率低于 30 FPS 时）
    - _需求: 10.3, 10.4, 10.5_
  
  - [ ]* 12.3 编写性能相关的基于属性的测试
    - **属性 21: 无内存泄漏** - 验证长时间运行无内存泄漏
    - **验证需求: 10.6**
  
  - [ ]* 12.4 编写性能基准测试
    - 使用 criterion 创建帧渲染基准测试
    - 测试形状遮罩切换性能（< 100ms）
    - 测试窗口缩放和旋转性能
    - 测试内存使用稳定性
    - _需求: 2.4, 2.5, 3.3, 3.4, 10.1-10.6_

- [x] 13. 集成测试和端到端测试
  - [x]* 13.1 编写完整的集成测试
    - 测试完整的用户工作流（启动 → 选择设备 → 切换形状 → 拖拽 → 缩放 → 旋转 → 关闭）
    - 测试配置持久化工作流（启动 → 修改设置 → 关闭 → 重新启动 → 验证设置恢复）
    - 测试错误恢复工作流（设备断开 → 重新连接 → 自动恢复）
    - 测试多设备切换工作流
    - _需求: 1.1, 1.3, 1.5, 2.1, 3.2, 4.1, 5.1, 6.1, 7.3, 7.4_
  
  - [x]* 13.2 编写边缘情况和压力测试
    - 测试空设备列表情况
    - 测试最小窗口尺寸（100x100）
    - 测试最大窗口尺寸（屏幕的 80%）
    - 测试边界旋转角度（0°、90°、180°、270°）
    - 测试窗口拖拽到屏幕边界外
    - 测试长时间运行稳定性（1 小时以上）
    - _需求: 4.5, 5.4, 5.5, 6.6, 8.1, 10.6_
  
  - [x]* 13.3 编写跨平台兼容性测试
    - 测试 Windows 平台特定功能
    - 测试 macOS 平台特定功能
    - 验证平台间配置文件兼容性
    - 测试不同屏幕分辨率和 DPI 设置
    - _需求: 9.1, 9.2, 9.3, 9.4_

- [x] 14. 最终检查点和发布准备
  - [x] 14.1 运行完整测试套件
    - 运行所有单元测试、属性测试和集成测试
    - 运行性能基准测试并验证性能指标
    - 检查代码覆盖率（目标 80% 以上）
    - 验证所有需求都有对应的测试覆盖
    - _需求: 所有需求_
  
  - [x] 14.2 优化构建和分发
    - 配置 release 构建优化
    - 使用静态链接减少外部依赖
    - 验证安装包大小（Windows < 20MB，macOS < 25MB）
    - 测试在干净环境中的安装和运行
    - _需求: 11.1, 11.2, 11.3, 11.4, 11.5, 11.6_
  
  - [x] 14.3 最终验证
    - 在 Windows 10+ 和 macOS 11+ 上测试
    - 验证所有核心功能正常工作
    - 验证性能指标符合要求（30+ FPS，< 200MB 内存，< 25% CPU）
    - 验证响应时间要求（拖拽 < 16ms，形状切换 < 100ms，启动 < 3 秒）
    - 确保所有测试通过，如有问题请询问用户
    - _需求: 9.1, 9.2, 10.1-10.6, 2.5, 3.4, 4.6, 7.1_

- [-] 15. 实现 UI 控制界面渲染
  - [x] 15.1 创建 UI 渲染管线
    - 创建专门的 UI 着色器（ui_shader.wgsl）支持 2D 几何图形渲染
    - 实现 UI 顶点缓冲区和索引缓冲区管理
    - 创建 UI 专用的渲染管线，支持透明度混合
    - 实现 UI 统一缓冲区，包含窗口尺寸和按钮位置信息
    - _需求: 12.3, 12.4, 12.8_
  
  - [x] 15.2 实现控制按钮视觉渲染
    - 实现圆形按钮几何体生成（使用三角扇形或圆形近似）
    - 实现按钮颜色和透明度渲染（关闭按钮红色，最小化按钮灰色）
    - 实现按钮符号渲染（X 和减号，使用简单线条几何体）
    - 添加按钮悬浮高亮效果（颜色变亮或边框高亮）
    - 确保按钮尺寸为 20x20 像素，位置在右上角
    - _需求: 12.3, 12.4, 12.8, 12.9, 12.10_
  
  - [x] 15.3 集成 UI 渲染到主渲染循环
    - 修改 `render_with_ui()` 方法，在主视频内容后渲染 UI 控件
    - 实现 UI 控件的深度测试和混合模式，确保显示在视频内容之上
    - 优化 UI 渲染性能，确保不影响主视频帧率
    - 添加 UI 渲染错误处理和恢复机制
    - _需求: 12.1, 12.2, 12.7_
  
  - [ ] 15.4 测试 UI 控制界面
    - 测试鼠标悬浮检测和 500ms 延迟显示
    - 测试控制按钮的点击检测和响应
    - 测试按钮视觉效果和透明度
    - 测试 UI 渲染性能影响
    - _需求: 12.1, 12.2, 12.5, 12.6, 12.7_

- [ ] 16. 实现右键上下文菜单
  - [x] 16.1 创建上下文菜单数据结构
    - 定义菜单项结构（文本、图标、回调函数）
    - 实现菜单布局计算（位置、尺寸、边界检查）
    - 创建菜单状态管理（显示/隐藏、选中项）
    - 实现菜单项分组（形状、摄像头、窗口控制、状态信息）
    - _需求: 13.2, 13.3, 13.4, 13.5_
  
  - [x] 16.2 实现上下文菜单渲染
    - 创建菜单背景渲染（半透明矩形）
    - 实现菜单项文本渲染（需要简单的文字渲染系统）
    - 添加菜单项悬浮高亮效果
    - 实现菜单边框和分隔线渲染
    - _需求: 13.8, 13.9_
  
  - [x] 16.3 集成上下文菜单到事件系统
    - 修改右键事件处理，显示可视化菜单而非控制台日志
    - 实现菜单项点击检测和事件分发
    - 添加菜单外点击检测，自动隐藏菜单
    - 实现菜单项执行和状态更新
    - _需求: 13.1, 13.6, 13.7_
  
  - [ ] 16.4 测试上下文菜单功能
    - 测试右键菜单显示和隐藏
    - 测试所有菜单项的功能执行
    - 测试菜单边界检查和位置调整
    - 测试菜单与其他 UI 元素的交互
    - _需求: 13.1-13.9_

- [ ] 17. 修复形状视觉差异化问题
  - [x] 17.1 修复椭圆形与圆形差异
    - 检查椭圆形生成算法，确保使用完整的窗口宽高比
    - 修改圆形生成算法，确保使用较小边作为直径
    - 测试不同窗口尺寸下的形状差异（如 400x300, 300x400）
    - 验证椭圆形在非正方形窗口中的视觉效果
    - _需求: 14.1, 14.2, 14.3_
  
  - [x] 17.2 优化心形大小和比例
    - 将心形缩放因子从 /8.0 进一步调整到 /6.0 或 /5.0
    - 测试心形在不同窗口尺寸下的显示效果
    - 确保心形占据窗口面积的至少 60%
    - 验证心形的居中显示和比例正确性
    - _需求: 14.4, 14.5_
  
  - [x] 17.3 改进形状边缘质量
    - 实现抗锯齿算法，使用距离场或多重采样
    - 优化形状生成的像素精度
    - 测试所有形状的边缘平滑度
    - 验证形状切换的性能影响（< 100ms）
    - _需求: 14.6, 14.7_
  
  - [ ] 17.4 测试形状差异化
    - 创建形状对比测试，验证每种形状的独特性
    - 测试形状在不同窗口尺寸下的表现
    - 验证形状切换的视觉效果和性能
    - 收集用户反馈，确认形状大小和清晰度
    - _需求: 14.1-14.7_

- [ ] 18. 极限优化拖拽性能
  - [x] 18.1 实现超低延迟拖拽
    - 将位置变化阈值从 0.1 像素降低到 0.05 像素
    - 实现直接的窗口位置更新，跳过所有中间验证
    - 使用专门的快速拖拽路径，避免日志和调试输出
    - 优化鼠标事件处理，确保 < 8ms 响应时间
    - _需求: 15.1, 15.2, 15.3_
  
  - [x] 18.2 优化拖拽内存分配
    - 预分配拖拽相关的数据结构，避免运行时分配
    - 使用对象池管理临时计算对象
    - 消除拖拽过程中的所有动态内存分配
    - 实现零拷贝的位置更新机制
    - _需求: 15.4, 15.7_
  
  - [x] 18.3 分离拖拽和边界检查
    - 实现拖拽过程中完全跳过边界检查
    - 仅在拖拽结束时应用边界约束
    - 使用异步边界检查，不阻塞拖拽更新
    - 优化边界计算算法，减少计算复杂度
    - _需求: 15.4, 15.5_
  
  - [ ] 18.4 测试拖拽性能
    - 使用高精度计时器测量拖拽响应时间
    - 测试拖拽过程中的帧率稳定性
    - 验证拖拽流畅度，确保无卡顿或跳跃
    - 进行长时间拖拽测试，验证性能稳定性
    - _需求: 15.1, 15.2, 15.6_

- [ ] 19. 最终 UI 和性能验证
  - [x] 19.1 综合 UI 功能测试
    - 测试所有 UI 控件的视觉渲染和交互功能
    - 验证 UI 控件与主视频内容的正确叠加
    - 测试 UI 控件在不同窗口尺寸下的适应性
    - 验证 UI 渲染对整体性能的影响
    - _需求: 12.1-12.10, 13.1-13.9_
  
  - [x] 19.2 形状和拖拽最终验证
    - 验证所有形状的视觉差异和正确显示
    - 测试拖拽的极限流畅性和响应速度
    - 确认心形大小满足用户要求
    - 验证椭圆形与圆形的明显区别
    - _需求: 14.1-14.7, 15.1-15.7_
  
  - [x] 19.3 用户体验最终测试
    - 进行完整的用户工作流测试
    - 收集用户反馈，确认所有问题已解决
    - 验证应用的整体流畅性和稳定性
    - 确保所有新功能不影响现有功能
    - _需求: 所有新增需求_

## 注意事项

- 标记为 `*` 的任务是可选的，可以跳过以加快 MVP 开发
- 每个任务都引用了具体的需求编号，确保可追溯性
- 检查点任务确保增量验证，及早发现问题
- 属性测试必须运行至少 100 次迭代
- 所有属性测试必须使用注释标记引用设计文档中的属性
- 性能要求：30+ FPS 渲染，< 200MB 内存，< 25% CPU 使用率
- 响应时间要求：拖拽 < 16ms，形状切换 < 100ms，启动 < 3 秒

## 测试配置

### 基于属性的测试标记格式
```rust
#[test]
fn property_test_name() {
    // Feature: mira, Property N: [属性描述]
    QuickCheck::new()
        .tests(100)
        .quickcheck(prop_function as fn() -> bool);
}
```

### 性能基准测试配置
- 使用 criterion 库进行性能基准测试
- 每个基准测试运行多次取平均值
- 设置性能回归检测阈值
- 记录性能指标到 CI/CD 系统